<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Phage Genomes (TSV)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
    h1 { margin: 0 0 12px; font-size: 1.25rem; }
    #status { margin: 12px 0; white-space: pre-wrap; }
    #search { margin: 8px 0 16px; padding: 8px; width: 100%; max-width: 420px; }
    table { border-collapse: collapse; width: 100%; font-size: 14px; }
    th, td { border: 1px solid #ddd; padding: 6px 8px; }
    th { background: #f5f5f5; position: sticky; top: 0; }
    .wrap { overflow: auto; max-height: 75vh; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Phage Genomes</h1>
  <div id="status">Loading…</div>
  <input id="search" type="search" placeholder="Type to filter rows…" class="hidden" />
  <div class="wrap"><table id="tbl"></table></div>

  <script>
    const DATA_URLS = ["data.tsv", "data.csv"]; // tries TSV then CSV
    const status = document.getElementById('status');
    const searchBox = document.getElementById('search');
    const table = document.getElementById('tbl');

    function log(msg){ status.textContent += (status.textContent ? "\n" : "") + msg; }

    async function fetchFirst() {
      let lastErr;
      for (const u of DATA_URLS) {
        try {
          log(`Trying ${u}…`);
          const r = await fetch(u, {cache:'no-store'});
          if (!r.ok) throw new Error(`HTTP ${r.status} ${r.statusText}`);
          return { text: await r.text(), url: u };
        } catch (e) { lastErr = e; log(`Failed ${u}: ${e.message}`); }
      }
      throw lastErr || new Error('No data file found.');
    }

    function parseTSVlike(text, delimGuess) {
      const raw = text.replace(/\r/g, '').trim();
      const lines = raw.split('\n').filter(Boolean);
      if (!lines.length) throw new Error('Empty file');
      const delim = delimGuess || (lines[0].includes('\t') ? '\t' : ',');
      const header = lines[0].split(delim);
      const rows = lines.slice(1).map(l => {
        const cols = l.split(delim);
        while (cols.length < header.length) cols.push('');
        return cols.slice(0, header.length);
      });
      return { header, rows };
    }

    function buildTable(header, rows) {
      const thead = document.createElement('thead');
      const htr = document.createElement('tr');
      header.forEach(h => { const th = document.createElement('th'); th.textContent = h; htr.appendChild(th); });
      thead.appendChild(htr);
      const tbody = document.createElement('tbody');
      rows.forEach(r => {
        const tr = document.createElement('tr');
        r.forEach(c => { const td = document.createElement('td'); td.textContent = c; tr.appendChild(td); });
        tbody.appendChild(tr);
      });
      table.replaceChildren(thead, tbody);
    }

    function wireSearch() {
      searchBox.classList.remove('hidden');
      searchBox.addEventListener('input', () => {
        const q = searchBox.value.toLowerCase();
        const rows = table.querySelectorAll('tbody tr');
        let shown = 0;
        rows.forEach(tr => {
          const txt = tr.textContent.toLowerCase();
          const match = txt.includes(q);
          tr.style.display = match ? '' : 'none';
          if (match) shown++;
        });
        status.textContent = `Rows: ${rows.length}  |  Showing: ${shown}`;
      });
    }

    (async () => {
      try {
        const { text, url } = await fetchFirst();
        const guessDelim = url.endsWith('.tsv') ? '\t' : ',';
        const { header, rows } = parseTSVlike(text, guessDelim);
        status.textContent = `Loaded ${url}  (${rows.length} rows, ${header.length} columns)`;
        buildTable(header, rows);
        wireSearch();
      } catch (e) {
        log(`\n❌ Could not load data: ${e.message}\nChecklist:\n• Make sure the page URL is amillard.github.io (not github.com)\n• Put index.html and data.tsv in the same published folder\n• Ensure the first line of the file is a header row`);
      }
    })();
  </script>
</body>
</html>
